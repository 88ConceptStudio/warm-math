<!DOCTYPE html>
<html>
<head>
    <title>WARM-MATH</title>
    <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Questrial', sans-serif; 
            text-align: center; 
            margin: 0 auto; 
            max-width: 800px; 
        }
        h1 { font-size: 36px; } /* WARM-MATH */
        h2 { font-size: 28px; } /* CO/CWU - założenia */
        h3 { font-size: 28px; } /* CO/CWU - wskaźniki */
        .form-group { 
            display: flex; 
            flex-direction: column; 
            margin-bottom: 10px; 
            align-items: center; 
        }
        label { font-size: 22px; margin-bottom: 5px; } /* Etykiety */
        input[type="number"], select { 
            width: 25%; 
            font-size: 22px; 
            height: 40px; 
            box-sizing: border-box; 
            font-family: 'Questrial', sans-serif; 
            border: 2px solid #000; 
        }
        p, li { font-size: 22px; } /* Tekst wyników */
        input[type="submit"] { 
            font-size: 22px; 
            height: 40px; 
            font-family: 'Questrial', sans-serif; 
            border: 2px solid #000; 
        }
        .results-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 20px;
        }
        .results-column {
            width: 45%;
        }
        .results-column h4 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .error {
            color: red;
            font-size: 22px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>WARM-MATH</h1>
    {% if error %}
    <p class="error">{{ error }}</p>
    {% endif %}
    <form method="POST">
        <div class="form-group">
            <label>Typ:</label>
            <select name="choice">
                <option value="">Wybierz...</option>
                <option value="CO" {% if choice == 'CO' %}selected{% endif %}>CO</option>
                <option value="CWU" {% if choice == 'CWU' %}selected{% endif %}>CWU</option>
            </select>
        </div>
        <input type="submit" value="Dalej">
    </form>

    {% if choice == 'CO' and not show_calc_form %}
    <h2>CO - założenia</h2>
    <form method="POST">
        <input type="hidden" name="choice" value="CO">
        <div class="form-group">
            <label>Powierzchnia [m²]:</label>
            <input type="number" name="m2" step="any" placeholder="np. 100" id="m2" value="{{ co_data.m2 }}">
        </div>
        <div class="form-group">
            <label>Wysokość [m]:</label>
            <input type="number" name="h" step="any" placeholder="np. 3" id="h" value="{{ co_data.h }}">
        </div>
        <div class="form-group">
            <label>Kubatura [m³]:</label>
            <input type="number" name="m3" step="any" placeholder="np. 300" id="m3" value="{{ co_data.m3 }}">
        </div>
        <div class="form-group">
            <label>Temp-OUT [°C]:</label>
            <input type="number" name="t_out" step="any" placeholder="np. -20" value="{{ co_data.t_out }}">
        </div>
        <div class="form-group">
            <label>Temp-IN [°C]:</label>
            <input type="number" name="t_in" step="any" placeholder="np. 20" value="{{ co_data.t_in }}">
        </div>
        <div class="form-group">
            <label>Typ budynku:</label>
            <select name="building_type">
                <option value="">Wybierz...</option>
                <option value="Mieszkanie" {% if co_data.building_type == 'Mieszkanie' %}selected{% endif %}>Mieszkanie</option>
                <option value="Dom" {% if co_data.building_type == 'Dom' %}selected{% endif %}>Dom</option>
                <option value="Magazyn" {% if co_data.building_type == 'Magazyn' %}selected{% endif %}>Magazyn</option>
                <option value="Biurowiec" {% if co_data.building_type == 'Biurowiec' %}selected{% endif %}>Biurowiec</option>
                <option value="Obiekt" {% if co_data.building_type == 'Obiekt' %}selected{% endif %}>Obiekt</option>
            </select>
        </div>
        <input type="submit" value="Wyślij">
    </form>
    <script>
        // Automatyczne obliczanie brakującej wartości (M2, H lub M3)
        const m2Input = document.querySelector('#m2');
        const hInput = document.querySelector('#h');
        const m3Input = document.querySelector('#m3');

        m2Input.addEventListener('input', updateFields);
        hInput.addEventListener('input', updateFields);
        m3Input.addEventListener('input', updateFields);

        function updateFields() {
            let m2 = parseFloat(m2Input.value) || 0;
            let h = parseFloat(hInput.value) || 0;
            let m3 = parseFloat(m3Input.value) || 0;

            let filledCount = [m2, h, m3].filter(val => val > 0).length;

            if (filledCount === 2) {
                if (m2 && h && !m3Input.value) {
                    m3Input.value = (m2 * h).toFixed(2);
                } else if (m2 && m3 && !hInput.value) {
                    hInput.value = m2 ? (m3 / m2).toFixed(2) : '';
                } else if (h && m3 && !m2Input.value) {
                    m2Input.value = h ? (m3 / h).toFixed(2) : '';
                }
            }
        }
    </script>
    {% endif %}

    {% if choice == 'CWU' and not show_calc_form %}
    <h2>CWU - założenia</h2>
    <form method="POST">
        <input type="hidden" name="choice" value="CWU">
        <div class="form-group">
            <label>Liczba osób:</label>
            <input type="number" name="people" step="1" placeholder="np. 4" value="{{ cwu_data.people }}">
        </div>
        <div class="form-group">
            <label>Temp-WU [°C]:</label>
            <input type="number" name="t_wu" step="any" placeholder="np. 40" value="{{ cwu_data.t_wu }}">
        </div>
        <div class="form-group">
            <label>Typ budynku:</label>
            <select name="building_type">
                <option value="">Wybierz...</option>
                <option value="Mieszkanie" {% if cwu_data.building_type == 'Mieszkanie' %}selected{% endif %}>Mieszkanie</option>
                <option value="Dom" {% if cwu_data.building_type == 'Dom' %}selected{% endif %}>Dom</option>
                <option value="Magazyn" {% if cwu_data.building_type == 'Magazyn' %}selected{% endif %}>Magazyn</option>
                <option value="Biurowiec" {% if cwu_data.building_type == 'Biurowiec' %}selected{% endif %}>Biurowiec</option>
                <option value="Obiekt" {% if cwu_data.building_type == 'Obiekt' %}selected{% endif %}>Obiekt</option>
            </select>
        </div>
        <input type="submit" value="Wyślij">
    </form>
    {% endif %}

    {% if show_calc_form %}
    <h2>{{ choice }} - wskaźniki</h2>
    <form method="POST">
        <input type="hidden" name="choice" value="{{ choice }}">
        {% if choice == 'CO' %}
        <input type="hidden" name="m2_prev" value="{{ co_data.m2 }}">
        <input type="hidden" name="h_prev" value="{{ co_data.h }}">
        <input type="hidden" name="m3_prev" value="{{ co_data.m3 }}">
        <input type="hidden" name="t_out_prev" value="{{ co_data.t_out }}">
        <input type="hidden" name="t_in_prev" value="{{ co_data.t_in }}">
        <input type="hidden" name="building_type_prev" value="{{ co_data.building_type }}">
        {% endif %}
        {% if choice == 'CWU' %}
        <input type="hidden" name="people_prev" value="{{ cwu_data.people }}">
        <input type="hidden" name="t_wu_prev" value="{{ cwu_data.t_wu }}">
        <input type="hidden" name="building_type_prev" value="{{ cwu_data.building_type }}">
        {% endif %}
        <div class="form-group">
            <label>Wartość opałowa gazu [kW/m³]:</label>
            <input type="number" name="kw_m3" step="any" value="10.5" min="9" max="11">
        </div>
        <div class="form-group">
            <label>Sprawność kotła [%]:</label>
            <input type="number" name="efficiency" step="any" value="100" min="10" max="150">
        </div>
        <div class="form-group">
            <label>Jednoczesność:</label>
            <input type="number" name="simultaneity" step="any" value="1" min="0.1" max="1">
        </div>
        <input type="submit" value="Wyślij">
    </form>
    {% endif %}

    {% if choice == 'CO' and (co_data.m2 or co_data.h or co_data.m3) %}
    <h3>CO - założenia</h3>
    <p>Powierzchnia: {{ co_data.m2 }} [m²]</p>
    <p>Wysokość: {{ co_data.h }} [m]</p>
    <p>Kubatura: {{ co_data.m3 }} [m³]</p>
    <p>Temp-OUT: {{ co_data.t_out }} [°C]</p>
    <p>Temp-IN: {{ co_data.t_in }} [°C]</p>
    <p>Typ budynku: {{ co_data.building_type }}</p>
    {% if calc_data.kw_m3 %}
    <p>Wartość opałowa gazu: {{ calc_data.kw_m3 }} [kW/m³]</p>
    <p>Sprawność kotła: {{ calc_data.efficiency * 100 }} [%]</p>
    <p>Jednoczesność: {{ calc_data.simultaneity }}</p>
    {% if results.heat_hour is not none %}
    <div class="results-container">
        <div class="results-column">
            <h4>Wartości ciepła</h4>
            <p>Ciepło na godzinę: {{ results.heat_hour }} [kW/h]</p>
            <p>Ciepło na dobę (24h): {{ results.heat_day }} [kW/d]</p>
            <p>Ciepło na rok (180d): {{ results.heat_year }} [kW/r]</p>
        </div>
        <div class="results-column">
            <h4>Wartości zużytego gazu</h4>
            <p>Gaz na godzinę: {{ results.gas_hour }} [m³/h]</p>
            <p>Gaz na dobę (24h): {{ results.gas_day }} [m³/d]</p>
            <p>Gaz na rok (180d): {{ results.gas_year }} [m³/r]</p>
        </div>
    </div>
    {% endif %}
    {% endif %}
    {% endif %}

    {% if choice == 'CWU' and cwu_data.people %}
    <h3>CWU - założenia</h3>
    <p>Liczba osób: {{ cwu_data.people }}</p>
    <p>Temp-WU: {{ cwu_data.t_wu }} [°C]</p>
    <p>Typ budynku: {{ cwu_data.building_type }}</p>
    {% if calc_data.kw_m3 %}
    <p>Wartość opałowa gazu: {{ calc_data.kw_m3 }} [kW/m³]</p>
    <p>Sprawność kotła: {{ calc_data.efficiency * 100 }} [%]</p>
    <p>Jednoczesność: {{ calc_data.simultaneity }}</p>
    {% if results.heat_hour is not none %}
    <div class="results-container">
        <div class="results-column">
            <h4>Wartości ciepła</h4>
            <p>Ciepło na godzinę: {{ results.heat_hour }} [kW/h]</p>
            <p>Ciepło na dobę (24h): {{ results.heat_day }} [kW/d]</p>
            <p>Ciepło na rok (365d): {{ results.heat_year }} [kW/r]</p>
        </div>
        <div class="results-column">
            <h4>Wartości zużytego gazu</h4>
            <p>Gaz na godzinę: {{ results.gas_hour }} [m³/h]</p>
            <p>Gaz na dobę (24h): {{ results.gas_day }} [m³/d]</p>
            <p>Gaz na rok (365d): {{ results.gas_year }} [m³/r]</p>
        </div>
    </div>
    {% endif %}
    {% endif %}
    {% endif %}

    <p>Wybrano: {{ choice }}</p>
</body>
</html>
